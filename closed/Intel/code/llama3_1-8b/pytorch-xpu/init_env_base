#!/bin/bash

export XPU_COUNT=$(python -c "import torch; count = 0; count = torch.xpu.device_count() if hasattr(torch, 'xpu') and torch.xpu.is_available() else 0; print(count)")
if (( XPU_COUNT > 0 )); then
    # XPU-specific
    export VLLM_USE_V1=1
    export VLLM_WORKER_MULTIPROC_METHOD=spawn

    export TORCH_LLM_ALLREDUCE=1
    export SYCL_PI_LEVEL_ZERO_USE_IMMEDIATE_COMMANDLISTS=2
    export CCL_ZE_IPC_EXCHANGE=drmfd
fi
# Set default values in case one value is not set
# E.g.: for TP>1 case, PP doesn't have to be set
export TP=1
export PP=1